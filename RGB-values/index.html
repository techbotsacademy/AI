<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Print RGB values (image format)</title>
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--muted:#9aa4b2;--accent:#60a5fa}
    html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial}
    body{background:linear-gradient(180deg,#071029 0%,#08122a 100%);color:#e6eef8;display:flex;align-items:flex-start;justify-content:center;padding:28px}
    .app{width:100%;max-width:980px}
    header{display:flex;gap:16px;align-items:center;margin-bottom:18px}
    h1{font-size:18px;margin:0}
    p.sub{margin:0;color:var(--muted);font-size:13px}
    .panel{background:rgba(255,255,255,0.03);border-radius:10px;padding:14px;box-shadow:0 6px 18px rgba(2,6,23,0.6)}
    .controls{display:flex;gap:12px;flex-wrap:wrap;align-items:center;margin-top:10px}
    label{font-size:13px;color:var(--muted)}
    input[type=file]{color:transparent}
    .btn{background:var(--accent);border:none;color:#052036;padding:8px 12px;border-radius:8px;cursor:pointer;font-weight:600}
    .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)}
    .row{display:flex;gap:12px;align-items:center}
    .canvas-wrap{display:flex;gap:16px;margin-top:14px;flex-wrap:wrap}
    .col{flex:1;min-width:260px}
    .canvas-box{background:rgba(255,255,255,0.02);padding:10px;border-radius:8px;display:flex;flex-direction:column;gap:10px}
    canvas{border-radius:6px;display:block;max-width:100%;height:auto}
    footer{margin-top:12px;color:var(--muted);font-size:13px}
    .small{font-size:12px;color:var(--muted)}
    input[type=number]{width:72px;padding:6px;border-radius:6px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit}
    .flex-right{margin-left:auto}
    #rgbGrid{margin-top:20px;text-align:center;font-family:monospace}
    .rowGrid{display:flex;justify-content:center}
    .cell{padding:4px 6px;margin:1px;border-radius:2px;font-size:10px}
    @media (max-width:640px){.controls{flex-direction:column;align-items:stretch}.row{width:100%;justify-content:space-between}}
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div>
        <h1>Print RGB values of an image (image-format)</h1>
        <p class="sub">Loads an image, samples pixels and creates a new image where each sample cell is filled with the pixel color and labeled with its RGB values. Also displays numeric RGB grid below.</p>
      </div>
    </header>

    <div class="panel">
      <div class="controls">
        <div class="row">
          <label class="small">Choose image</label>
          <input id="file" type="file" accept="image/*" />
        </div>
        <div class="row">
          <label class="small">Sample step</label>
          <input id="step" type="number" min="1" value="4" title="How many pixels to skip when sampling" />
        </div>
        <div class="row">
          <label class="small">Font size (px)</label>
          <input id="fontSize" type="number" min="6" value="10" />
        </div>
        <button id="generate" class="btn">Generate image</button>
        <button id="download" class="btn ghost" disabled>Download PNG</button>
        <div class="flex-right small">Tip: smaller step → more detail (slower)</div>
      </div>

      <div class="canvas-wrap">
        <div class="col canvas-box">
          <div class="small">Original</div>
          <canvas id="origCanvas"></canvas>
        </div>
        <div class="col canvas-box">
          <div class="small">RGB Image (numbers drawn on color)</div>
          <canvas id="rgbCanvas"></canvas>
        </div>
      </div>

      <div id="rgbGrid"></div>

      <footer>
        Works fully in your browser — no server. If a large image is used, increase the sampling step for performance.
      </footer>
    </div>
  </div>

  <script>
    const fileEl = document.getElementById('file');
    const origCanvas = document.getElementById('origCanvas');
    const rgbCanvas = document.getElementById('rgbCanvas');
    const rgbGridDiv = document.getElementById('rgbGrid');
    const generateBtn = document.getElementById('generate');
    const downloadBtn = document.getElementById('download');
    const stepInput = document.getElementById('step');
    const fontSizeInput = document.getElementById('fontSize');
    const origCtx = origCanvas.getContext('2d');
    const rgbCtx = rgbCanvas.getContext('2d');
    let loadedImage = null;

    fileEl.addEventListener('change', (e)=>{
      const file = e.target.files && e.target.files[0];
      if(!file) return;
      const url = URL.createObjectURL(file);
      loadImage(url);
    });

    function loadImage(src){
      const img = new Image();
      img.onload = ()=>{
        loadedImage = img;
        const maxW = 480;
        const scale = Math.min(1, maxW / img.width);
        origCanvas.width = Math.round(img.width * scale);
        origCanvas.height = Math.round(img.height * scale);
        origCtx.clearRect(0,0,origCanvas.width,origCanvas.height);
        origCtx.drawImage(img,0,0,origCanvas.width,origCanvas.height);
        rgbCanvas.width = origCanvas.width;
        rgbCanvas.height = origCanvas.height;
        rgbCtx.clearRect(0,0,rgbCanvas.width,rgbCanvas.height);
        rgbGridDiv.innerHTML = '';
        downloadBtn.disabled = true;
      };
      img.onerror = ()=>alert('Could not load image.');
      img.src = src;
    }

    function generateRGBImage(){
      if(!loadedImage){ alert('Please load an image first.'); return; }
      const step = Math.max(1, parseInt(stepInput.value,10) || 4);
      const fontSize = Math.max(6, parseInt(fontSizeInput.value,10) || 10);
      const off = document.createElement('canvas');
      const offCtx = off.getContext('2d');
      off.width = loadedImage.width;
      off.height = loadedImage.height;
      offCtx.drawImage(loadedImage,0,0);
      const imgW = off.width, imgH = off.height;
      const displayW = origCanvas.width, displayH = origCanvas.height;
      const scale = imgW / displayW;

      rgbCanvas.width = displayW;
      rgbCanvas.height = displayH;
      rgbCtx.font = `${fontSize}px monospace`;
      rgbCtx.textAlign = 'center';
      rgbCtx.textBaseline = 'middle';
      rgbCtx.clearRect(0,0,displayW,displayH);
      rgbGridDiv.innerHTML = '';

      for(let y=0;y<imgH;y+=step){
        const rowDiv = document.createElement('div');
        rowDiv.className = 'rowGrid';
        for(let x=0;x<imgW;x+=step){
          const px = offCtx.getImageData(x, y, 1, 1).data;
          const [r,g,b] = px;
          const dispX = Math.floor(x / scale);
          const dispY = Math.floor(y / scale);
          const cellW = Math.ceil(step / scale);
          const cellH = Math.ceil(step / scale);

          // Draw colored cell on canvas
          rgbCtx.fillStyle = `rgb(${r},${g},${b})`;
          rgbCtx.fillRect(dispX, dispY, cellW, cellH);
          const luminance = (0.299*r + 0.587*g + 0.114*b);
          //rgbCtx.fillStyle = luminance > 150 ? 'black' : 'white';
          rgbCtx.fillText(`${r},${g},${b}`, dispX + cellW/2, dispY + cellH/2);

          // Create numeric RGB cell in grid
          const cell = document.createElement('div');
          cell.className = 'cell';
          cell.style.backgroundColor = `rgb(${r},${g},${b})`;
          //cell.style.color = (r+g+b)/3 < 128 ? 'white' : 'black';
          cell.textContent = `[${r},${g},${b}]`;
          rowDiv.appendChild(cell);
        }
        rgbGridDiv.appendChild(rowDiv);
      }
      downloadBtn.disabled = false;
    }

    generateBtn.addEventListener('click', generateRGBImage);
    downloadBtn.addEventListener('click', ()=>{
      const url = rgbCanvas.toDataURL('image/png');
      const a = document.createElement('a');
      a.href = url;
      a.download = 'rgb-values.png';
      a.click();
    });

    const sampleDataURL = 'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="256" height="128"><rect width="256" height="128" fill="lightblue"/><circle cx="64" cy="64" r="48" fill="orange"/><rect x="140" y="24" width="80" height="80" fill=\"%234caf50\"/></svg>';
    loadImage(sampleDataURL);
  </script>
</body>
</html>
