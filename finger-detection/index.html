<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Finger Counter - MediaPipe</title>

    <!-- Mediapipe Hands -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script>

    <style>
        body {
            font-family: Arial;
            display: flex;
            flex-direction: column;
            align-items: center;
            background: #f5f5f5;
        }
        video, canvas {
            border: 3px solid black;
            border-radius: 10px;
            margin-top: 20px;
        }
        #countBox {
            font-size: 40px;
            margin-top: 20px;
            padding: 10px 20px;
            background: white;
            border-radius: 10px;
            border: 2px solid #333;
        }
    </style>
</head>
<body>

<h1>Finger Count using MediaPipe</h1>

<video id="video" width="640" height="480" autoplay></video>
<canvas id="output" width="640" height="480"></canvas>

<div id="countBox">Fingers: 0</div>

<script>
    const videoElement = document.getElementById("video");
    const canvasElement = document.getElementById("output");
    const canvasCtx = canvasElement.getContext("2d");
    const countBox = document.getElementById("countBox");

    function countFingers(landmarks) {
        // Thumb
        let thumb = landmarks[4].x < landmarks[3].x ? 1 : 0;

        // Other 4 fingers
        let fingers = [
            (landmarks[8].y < landmarks[6].y) ? 1 : 0,   // index
            (landmarks[12].y < landmarks[10].y) ? 1 : 0, // middle
            (landmarks[16].y < landmarks[14].y) ? 1 : 0, // ring
            (landmarks[20].y < landmarks[18].y) ? 1 : 0  // pinky
        ];

        let total = thumb + fingers.reduce((a,b) => a+b, 0);
        return total;
    }

    function onResults(results) {
        canvasCtx.save();
        canvasCtx.clearRect(0, 0, canvasElement.width, canvasElement.height);

        canvasCtx.drawImage(results.image, 0, 0, canvasElement.width, canvasElement.height);

        if (results.multiHandLandmarks && results.multiHandLandmarks.length > 0) {
            let landmarks = results.multiHandLandmarks[0];

            // Draw landmarks
            drawConnectors(canvasCtx, landmarks, HAND_CONNECTIONS, {color: '#00FF00', lineWidth: 3});
            drawLandmarks(canvasCtx, landmarks, {color: '#FF0000', lineWidth: 2});

            // Count fingers
            let fingers = countFingers(landmarks);
            countBox.innerText = "Fingers: " + fingers;
        }

        canvasCtx.restore();
    }

    const hands = new Hands({
        locateFile: (file) => {
            return `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`;
        }
    });

    hands.setOptions({
        maxNumHands: 1,
        modelComplexity: 1,
        minDetectionConfidence: 0.7,
        minTrackingConfidence: 0.7
    });

    hands.onResults(onResults);

    const camera = new Camera(videoElement, {
        onFrame: async () => {
            await hands.send({image: videoElement});
        },
        width: 640,
        height: 480
    });
    camera.start();

</script>

</body>
</html>
